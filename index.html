<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Is it Sunny in Ireland?</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Top 400+ Irish cities/towns with coordinates (sample - you'd need complete list)
    const IRISH_LOCATIONS = [
      { name: 'Dublin', lat: 53.3498, lon: -6.2603 },
      { name: 'Cork', lat: 51.8969, lon: -8.4863 },
      { name: 'Limerick', lat: 52.6638, lon: -8.6267 },
      { name: 'Galway', lat: 53.2707, lon: -9.0568 },
      { name: 'Waterford', lat: 52.2593, lon: -7.1101 },
      { name: 'Drogheda', lat: 53.7189, lon: -6.3478 },
      { name: 'Dundalk', lat: 54.0000, lon: -6.4167 },
      { name: 'Sligo', lat: 54.2697, lon: -8.4694 },
      { name: 'Kilkenny', lat: 52.6541, lon: -7.2448 },
      { name: 'Wexford', lat: 52.3369, lon: -6.4633 },
      // Add remaining 390+ locations here
    ];

    // Lucide React icons (simplified inline SVG)
    const Sun = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="12" cy="12" r="5"/>
        <line x1="12" y1="1" x2="12" y2="3"/>
        <line x1="12" y1="21" x2="12" y2="23"/>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
        <line x1="1" y1="12" x2="3" y2="12"/>
        <line x1="21" y1="12" x2="23" y2="12"/>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
      </svg>
    );

    const Cloud = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/>
      </svg>
    );

    const MapPin = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
        <circle cx="12" cy="10" r="3"/>
      </svg>
    );

    const Calendar = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
        <line x1="16" y1="2" x2="16" y2="6"/>
        <line x1="8" y1="2" x2="8" y2="6"/>
        <line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
    );

    const AlertTriangle = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
        <line x1="12" y1="9" x2="12" y2="13"/>
        <line x1="12" y1="17" x2="12.01" y2="17"/>
      </svg>
    );

    const Info = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="16" x2="12" y2="12"/>
        <line x1="12" y1="8" x2="12.01" y2="8"/>
      </svg>
    );

    const IsSunnyInIreland = () => {
      const [selectedDate, setSelectedDate] = useState(null);
      const [loading, setLoading] = useState(false);
      const [sunnyLocations, setSunnyLocations] = useState([]);
      const [userLocation, setUserLocation] = useState(null);
      const [weatherWarnings, setWeatherWarnings] = useState([]);
      const [showWarnings, setShowWarnings] = useState(false);

      useEffect(() => {
        // Get user location
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              setUserLocation({
                lat: position.coords.latitude,
                lon: position.coords.longitude
              });
            },
            (error) => {
              console.log('Location access denied, using default (Dublin)');
              setUserLocation({ lat: 53.3498, lon: -6.2603 });
            }
          );
        } else {
          setUserLocation({ lat: 53.3498, lon: -6.2603 });
        }

        // Fetch weather warnings
        fetchWeatherWarnings();
      }, []);

      const fetchWeatherWarnings = async () => {
        try {
          const response = await fetch('https://www.met.ie/Open_Data/json/warning_EIXX.json');
          if (response.ok) {
            const data = await response.json();
            setWeatherWarnings(data.warnings || []);
          }
        } catch (error) {
          console.error('Error fetching warnings:', error);
        }
      };

      const getCachedForecast = (location) => {
        const cacheKey = `weather_${location.lat}_${location.lon}`;
        const cached = localStorage.getItem(cacheKey);
        
        if (cached) {
          const data = JSON.parse(cached);
          const cacheAge = Date.now() - data.timestamp;
          // 3 hours = 10,800,000 milliseconds
          if (cacheAge < 10800000) {
            return data.forecast;
          }
        }
        return null;
      };

      const cacheForecast = (location, forecast) => {
        const cacheKey = `weather_${location.lat}_${location.lon}`;
        localStorage.setItem(cacheKey, JSON.stringify({
          timestamp: Date.now(),
          forecast: forecast
        }));
      };

      const fetchWeatherForLocation = async (location) => {
        const cached = getCachedForecast(location);
        if (cached) {
          return cached;
        }

        try {
          const response = await fetch(
            `http://openaccess.pf.api.met.ie/metno-wdb2ts/locationforecast?lat=${location.lat};long=${location.lon}`
          );
          
          if (!response.ok) throw new Error('API request failed');
          
          const xmlText = await response.text();
          const parser = new DOMParser();
          const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
          
          const forecast = parseMetEireannForecast(xmlDoc);
          cacheForecast(location, forecast);
          
          return forecast;
        } catch (error) {
          console.error(`Error fetching weather for ${location.name}:`, error);
          return null;
        }
      };

      const parseMetEireannForecast = (xmlDoc) => {
        const times = xmlDoc.querySelectorAll('time');
        const dailyForecasts = {};

        times.forEach(time => {
          const from = time.getAttribute('from');
          const date = from.split('T')[0];
          
          const symbol = time.querySelector('symbol');
          const symbolCode = symbol?.getAttribute('number') || '4';
          
          if (!dailyForecasts[date]) {
            dailyForecasts[date] = [];
          }
          dailyForecasts[date].push(parseInt(symbolCode));
        });

        const result = {};
        Object.keys(dailyForecasts).forEach(date => {
          const codes = dailyForecasts[date];
          const sunnyPeriods = codes.filter(c => c <= 3).length;
          result[date] = sunnyPeriods >= codes.length * 0.5;
        });

        return result;
      };

      const calculateDistance = (lat1, lon1, lat2, lon2) => {
        const R = 6371;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = 
          Math.sin(dLat/2) * Math.sin(dLat/2) +
          Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
          Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
      };

      const checkSunnyLocations = async () => {
        if (!selectedDate || !userLocation) return;

        setLoading(true);
        setSunnyLocations([]);

        const dateStr = selectedDate.toISOS
